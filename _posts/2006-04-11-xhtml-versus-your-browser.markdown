---
layout: post
title: "XHTML versus your browser"
date: 2006-04-11
comments: false
categories:
 - Hippo CMS
 - Cocoon
---

<div class='post'>
Using XHTML with Cocoon is sometimes a little frustrating. It seems that by using the default XHTML serializer configuration located on the <a href="http://cocoon.apache.org/2.1/userdocs/xhtml-serializer.html" target="_blank">Cocoon Wiki</a> your rendered page is not valid XHTML.<br/>While taking a closer look at the configuration (see below) you will notice that it uses the XMLSerializer as its source.<br/><br/><pre><br/>&lt;map:serializer name=&quot;xhtml&quot;<br/>src=&quot;org.apache.cocoon.serialization.XMLSerializer&quot;<br/>mime-type=&quot;text/html&quot; logger=&quot;sitemap.serializer.xhtml&quot;<br/>pool-max=&quot;64&quot;&gt;<br/>&lt;doctype-public&gt;-//W3C//DTD XHTML 1.0 Strict//EN&lt;/doctype-public&gt;<br/>&lt;doctype-system&gt;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&lt;/doctype-system&gt;<br/>&lt;encoding&gt;UTF-8&lt;/encoding&gt;<br/>&lt;/map:serializer&gt;<br/></pre><br/><br/>While the output is XML valid, the browser does not completely seem to understand the requested XHTML.<br/>For example: If you would use a div element that doesn't contain content it would make the browser choke and all the XHTML after that element, would be included in the div element. If you would view the page source, everything seems fine, but the browser does not parse the XHTML correctly because of the closed tag. The page source will show you the closed div tag.<br/><code><br/>&lt;div /&gt;<br/></code><br/>The above looks valid in an XML point of view. But the only way the browser likes it, is if you open it and close it again.<br/><code><br/>&lt;div&gt;&lt;/div&gt;<br/></code><br/>At first I thought it was the browser to blaim, but after quick look at the W3C specs it seems that according to the official DTD you are not allowed to create 'empty' div elements or empty textarea elements. With 'empty' they mean &lt;div /&gt;. A quick workaround is to put a space inside the empty element. This is not a clean way of fixing things and it could also break the design.<br/><br/>After digging through the Cocoon blocks I found a XHTMLSerializer in the serializers block that did fix this problem. The XHTMLSerializer has an closeElement implementation that leaves certain elements 'open', so the browser will render the page correctly.<br/>This serializer has one disadvantage though: if you use inline Javascript, it will convert all quote characters to &amp;quote;. A quick workaround is to put all your Javascript in to script tags and include them from a remote file.<br/><br/>That leaves me with a choise between two options that are not 100% what I need. For now it seems that I can continue to work with the XHTMLSerializer from the serializers block since I do not have inline Javascript function calls.<br/><br/><strong>UPDATE</strong><br/>After reading Arthur's comment ( thanks !! ), I found out that I missed a part of the W3C specs. According to the <a href="http://www.w3.org/TR/2002/NOTE-xhtml-media-types-20020801/#media-types" target="_blank">W3C specs</a> you will also have to provide the correct mime-type for the browser to render it as XHTML. When using XHTML you <strong>must</strong> send <strong>application/xhtml+xml</strong> as the mime-type to the browser and not text/html. After a quick test it seems that FireFox can handle this, but IE 6 can't. I've not been able to test it on IE 7 yet, but let's hope they fixed it.<br/><br/>In the end it still leaves me with the problem that I can't render my XHTML the way I want, without doing any work-arounds for some browsers.<br/><br/></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Arthur</div>
<div class='content'>
According to the w3c spec on xhtml empty elements it is the browser that messes up, but this may as well be a mime-type problem (tellig the browser it's 'text/html' when it is actually 'application/xhtml+xml'. The problem with this mime-type though, is that IE6 will present the user with a download dialog, instead of rendering xhtml...<br></div>
</div>
</div>
